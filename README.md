# API-server подсистемы определения темы комментария для проекта "Активный гражданин"

Проект "Активный гражданин", реализуемый на территории Оренбургской области, позволяет гражданам сообщать о проблемах различного характера, которые их волнуют.

Однако для оперативного решения проблем нужно их отправлять в соответствующие ведомства, для этого нужно понять тему обращения, что весьма проблематично, так как их много.

Данный проект должен решить эту проблему.

# Классификатор

Большое спасибо за создание классификатора [Александру Шухману](https://github.com/AlexanderShukhman). Блокнот с обучением модели доступен по [ссылке](https://colab.research.google.com/drive/1FE3aaKfO5zm-_V6EuZiTaV8W9a0XMWyp?usp=sharing).

Используется два классификатора, один определяет тему, другой категорию.

# Описание API

Основной объект - обращение (appeal) гражданина.

Пока аутентификации нет.

## Обращение

Примерно вот так выглядит json с обращением:

```
{
  "ok": true,
  "id": 5186,
  "text": "Реклама на асфальте",
  "detailed_text": "Яма в асфальте",
  "category": "Дороги",
  "theme": "Ямы, выбоины, выступы на дороге, тротуаре",
  "predicted_themes": [
    {
      "id": 12,
      "title": "Ямы, выбоины, выступы на дороге, тротуаре"
    },
    {
      "id": 27,
      "title": "Несвоевременная уборка территории контейнерной площадки"
    },
    {
      "id": 18,
      "title": "Реклама на тротуаре во дворах"
    }
  ]
}
```

Описание json'a:

* **ok** - bool, если true, то далее будет само обращение, иначе далее будет "error", в котором содержится информация об ошибке 
* **id** - int, id обращения в системе
* **text** - string, текст обращения
* **detailed_text** - string, более подробный текст обращения, если обращение было дополнено
* **category** - string, категория обращения, если обращение было закоммичено (подтверждено)
* **theme** - string, тема обращения, если обращение было закоммичено
* **predicted_themes** - массив тем, которые определила система в порядке убывания вероятности (сначала самые вероятные)
    * **id** - int, id темы в системе
    * **title** - string, сам заголовок темы





## Получить обращение

Используется для получения информации об обращении

method: GET

request: */api/v1/appeal/{id}*

**id** - id обращения

body: empty

response: обращение (см. выше)

## Создать обращение

Используется для создания нового обращения

method: POST

request: */api/v1/create*

body: json следующего формата
```
{
    "text": "Яма на пешеходном переходе"
}
```

response: обращение (см. выше)

## Дополнить обращение

Используется, чтобы дополнить обращение, если хотите добиться лучших результатов анализа

method: PUT

request: */api/v1/appeal/{id}/complement*

**id** - id обращения

body: json следующего формата
```
{
    "detailed_text": "Яма близ пешеходного перехода около Пироговки"
}
```

response: обращение (см. выше)

## Зафиксировать тему обращения

Используется для того, чтобы зафиксировать выбранную гражданином тему обращения в системе

method: PUT

request: */api/v1/appeal/{id}/commit/{theme_id}*

**id** - id обращения

**theme_id** - id темы, которую фиксируем

response: обращение (см. выше)

## Получить список категорий

Используется для того, чтобы получить список категорий, определенных моделью, в порядке уменьшения вероятности

method: GET

request: */api/v1/appeal/{id}/get_categories*

**id** - id обращения

response: json следующего формата
```
{
  "ok": true,
  "categories": [
    {
      "id": 2,
      "title": "Дворы"
    },
    {
      "id": 1,
      "title": "Дороги"
    },
    {
      "id": 3,
      "title": "Парки и общественные территории"
    },
    {
      "id": 89,
      "title": "Уличное освещение"
    },
    {
      "id": 78,
      "title": "Общественный транспорт"
    },
    {
      "id": 2201,
      "title": "Социальная помощь"
    },
    {
      "id": 66,
      "title": "Реклама и граффити"
    }
  ]
}
```
## Получить список тем

Используется для того, чтобы получить список тем, определенных моделью, в порядке уменьшения вероятности, согласно выбранной категории

method: GET

request: */api/v1/appeal/{id}/get_themes/{cat_id}*

**id** - id обращения

**cat_id** - id категории

response: json следующего формата
```
{
  "ok": true,
  "themes": [
    {
      "id": 25,
      "title": "Мусор на придомовой территории"
    },
    {
      "id": 26,
      "title": "Нарушение графика вывоза мусора с контейнерной площадки"
    },
    {
      "id": 27,
      "title": "Несвоевременная уборка территории контейнерной площадки"
    },
    {
      "id": 13,
      "title": "Ямы, выбоины, выступы на придомовой территории"
    },
    {
      "id": 42,
      "title": "Неубранный снег, гололед во дворе"
    },
    {
      "id": 18,
      "title": "Реклама на тротуаре во дворах"
    },
    {
      "id": 37,
      "title": "Некачественный уход за деревьями, кустарниками на придомовой территории (кронирование, вырубка сухостоев, ликвидация аварийных деревьев) во дворах"
    },
    {
      "id": 31,
      "title": "Нескошенная трава на придомовой территории"
    },
    {
      "id": 5,
      "title": "Неисправное освещение во дворах"
    },
    {
      "id": 16,
      "title": "Открытый (просевший) люк или ливневка во дворе"
    },
    {
      "id": 20,
      "title": "Неисправность/недоступность инфраструктуры для маломобильных граждан / колясок во дворе"
    },
    {
      "id": 30,
      "title": "Вытоптанный, заезженный газон"
    },
    {
      "id": 44,
      "title": "Снег, наледь на входных группах, перилах"
    },
    {
      "id": 38,
      "title": "Брошенный разукомплектованный автомобиль на проезжей части, во дворе"
    },
    {
      "id": 43,
      "title": "Снег, сосульки на крыше дома"
    }
  ]
}
```